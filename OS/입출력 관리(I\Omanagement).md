## OS - 입출력 관리

![i/oStructure](https://velog.velcdn.com/images/yonii/post/007125a4-383e-4e7c-8b1b-dd53d096a32a/image.png)

컴퓨터의 주요한 작업에는 연산작업과 **입출력 작업** 2가지가 있다.  

그 중 입출력 작업은 컴퓨터에 연결된 다양한 입출력 하드웨어 장치들과 어떤 식으로 소통이 이루어지는지에 관한 내용이다.

예를 들어 마우스, 키보드, 모니터 등 다양한 장치들이 컴퓨터와 잘 동작하게 하려면 둘 사이에 공통된 인터페이스가 존재해야한다.  

바로 **컴퓨터와 하드웨어 장치 사이의 공통된 인터페이스 역할을 수행하는 것이 입출력 관리의 핵심이다.**
<br></br>
## 입출력 하드웨어의 구성

하드웨어 장치는 케이블을 통해서 또는 무선으로 신호를 보냄으로써 컴퓨터와 통신한다.  

이때 포트를통해 컴퓨터에 접속하는데, 하드웨어 장치의 또다른 구성요소는 **제어기**이다.  

(제어기: 포트나 입출력 장치를 제어하는 전자회로의 집합체이며 많은 입출력 장치는 제어기를 내장하고 있다.)

🤔**그럼 컴퓨터는 어떻게 장치의 제어기에서 입출력을 하도록 명령할까?**

모든 제어기는 레지스터를 가진다. 컴퓨터의 프로세서는 제어기 레지스터에 bit pattern을 쓰거나 읽음으로써 입출력을 실행한다.  
<br></br>

## 입출력 하드웨어의 동작

**1. 폴링**

장치 제어기의 레지스터에는 busy bit라는 것이 존재한다.

**busy bit**: 현재 장치가 사용 가능한 상태인지, 다른 작업을 처리중이라 사용이 불가능한 상태인지를 나타내는 bit.

> 1-> 제어기가 작업하느라 바쁜 경우  
> 0-> 제어기가 준비중인 경우

컴퓨터는 장치가 사용중인지 알기위해 주기적으로 busy bit를 검사해야하는데 이 과정을 **폴링**이라고 한다.

> **폴링이란 하드웨어 장치의 상태를 수시로 체크하여 명령을 받을 수 있는지를 확인하는 것**을 말한다.

폴링 자체는 컴퓨터 자원이 많이 소요되지 않지만 장치가 준비하는 시간이 길어질 경우 매우 비효율적이라는 단점이 있다.  

이런 경우에 제어기가 자신의 상태가 바뀔 때 컴퓨터에 통보해주는 방식으로 비효율을 막을 수 있다.  

이때 발생시키는 신호를 **인터럽트**라고 한다.  

**2.인터럽트**

>인터럽트란 CPU가 프로그램을 실행하고 있을 때, 입출력 하드웨어 등의 장치나
>예외상황이 발생하여 처리가 필요할 경우에 CPU에게 알려 처리할 수 있도록 하는 것을 말한다.

CPU는 인터럽트 요청 라인이라고 하는 선을 가지는데 CPU는 매번 명령어를 끝내고 다음 명령어를 수행하기 전에 이 선을 검사한다.  

만약 입출력 장치가 준비 완료되어서 인터럽트 요청 라인에 신호를 보내면, CPU는 인터럽트를 확인하고 인터럽트 핸들러를 실행한다.  

(인터럽트 핸들러: 입출력 장치를 서비스함으로써, 인터럽트를 처리해준다.)  

CPU는 인터럽트 발생시 직전 작업 상태를 저장해두고 인터럽트를 처리한다.  

인터럽트 처리가 완료된 이후에는 인터럽트 발생전 상태를 복구시켜 중단되었던 작업을 재개한다.

>EX)  
>1. 사용자가 키보드를 사용하여 입력하면 키보드 컨트롤러가 인터럽트를 발생시켜 CPU에게 그 사실을 알림.  
>
>2. CPU는 현재 수행중이던 작업의 상태를 저장, 인터럽트 요청을 처리하기위해 운영체제 내에 정의된 키보드 인터럽트 처리 루틴을 찾음  
>
>3. 키보드 인터럽트 처리 루틴을 실행하고 완료.  
>
>4. 인터럽트 처리가 끝나면 인터럽트가 발생하기 직전 상태를 복구시켜 중단되었던 작업을 재개.

<br></br>
## 입출력 하드웨어와 컴퓨터가 데이터를 주고받는 방식  

만약 CPU를 사용하여 디스크와 같은 대용량 입출력 장치의 데이터를 읽으면 CPU 사용량이  

매우 높아져 컴퓨터 성능이 심각하게 저하된다는 문제가 발생한다. 따라서 CPU가 매번 바이트 전송을 제어하는 것은 심한 낭비이다.  

(PIO: CPU가 1바이트씩 옮기는 입출력 방식)  

많은 컴퓨터들의 CPU의 낭비를 막기 위해서 PIO를 DMA(Direct Memory Access)제어기라고 불리는 특수 프로세서에게 위임하여 CPU의 일을 줄여준다.

**직접 메모리 접근(Direct Memory Access)**

![DMA](https://velog.velcdn.com/images%2Fyonii%2Fpost%2F1eae148f-27d5-479e-8b90-532ef28bb68a%2Fimage.png)  

컴퓨터는 메모리에 DMA 명령 블록을 쓴다. 이 블록에는 전송할 데이터가 있는 곳의 포인터와  

전송할 장소에 대한 포인터, 그리고 전송될 바이트 수가 기록된다.  

CPU는 DMA 명령블록의 주소를 DMA에게 알려주고 자신은 다른 일을 처리한다.  

즉 **DMA는 CPU의 도움없이 자신이 직접 버스를 통해 DMA 명령블록에 접근하여 입출력을 실행**한다.

>**DMA 입출력 방식의 작동 과정**
>
>1. CPU가 입출력 요청을 보낸다.
>
>2. DMA제어기의 레지스터에 주소와 전송 길이가 저장된다.
>
>3. DMA 제어기는 한 블록의 입출력 동작을 수행하고 그동안 CPU는 다른 작업을 한다.
>
>4. 입출력 동작이 완료되면 DMA제어기는 CPU에게 완료했다는 인터럽트를 보낸다.

# 출처
* https://velog.io/@yonii/OS-%EC%9E%85%EC%B6%9C%EB%A0%A5-%EA%B4%80%EB%A6%AC
